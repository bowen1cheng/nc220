<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editable Table with Firestore Update</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        table,
        th,
        td {
            border: 1px solid black;
        }

        th,
        td {
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-firestore.js"></script>
</head>

<body>

    <h2>Editable Table with Firestore Update</h2>

    <!-- 新行 -->
    <div style="margin-bottom: 10px;">
        <strong>Module Code:</strong> 2-1-4
    </div>

    <table id="editableTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Score</th>
            </tr>
        </thead>
        <tbody id="tbody">

        </tbody>
    </table>

    <script>
        // Firebase 配置，需要替换成您自己的配置
        var firebaseConfig = {
            apiKey: "AIzaSyAieo87PuMM8udmYTa9uwE0DaGvfpeK5X4",
            authDomain: "table-b091a.firebaseapp.com",
            projectId: "table-b091a",
            storageBucket: "table-b091a.appspot.com",
            messagingSenderId: "583106973229",
            appId: "1:583106973229:web:04b0dcc889f394d22cf2a4",
            measurementId: "G-M0HQP10EX0"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Get Firestore reference
        var db = firebase.firestore();
        const collectionName = "students";

        // 获取集合中的数据
        db.collection(collectionName)
            .orderBy("id")
            .get()
            .then((querySnapshot) => {
                let html = '';

                querySnapshot.forEach((doc) => {
                    let item = doc.data();
                    item._id = doc.id;
                    console.log("item = ", item);
                    html += `
                        <tr>
                            <td>${item.id}</td>
                            <td>${item.name}</td>
                            <td onblur="handleBlur(event, '${item._id}')" contentEditable>${item.score}</td>
                        </tr>
                    `;
                });
                document.getElementById('tbody').innerHTML = html;
            })
            .catch((error) => {
                console.error("Error getting documents: ", error);
            });

        function handleBlur(event, _id) {
            // 处理失去焦点事件
            const newValue = event.target.textContent;
            console.log("New value:", newValue);
            console.log("_id = ", _id)
            // 保存新值到数据库
            db.collection(collectionName).doc(_id).update({
                score: newValue
            }).then(() => {
                console.log('Data updated successfully!');
            })
                .catch((error) => {
                    console.error('Error updating data:', error);
                });
        }
    </script>

</body>

</html>





